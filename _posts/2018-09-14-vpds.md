---
layout: post
title: "Introduction to virtual private databases"
date: 2018-09-14 00:00
comments: true
author: Harish Chandra Durgapal
published: true
authorIsRacker: true
categories:
    - General
---

Originally published by TriCore: December 14, 2017

Introduced in Oracle8i&trade;, Oracle&reg; Virtual Private Database (VPD) is
the most popular security feature of [Oracle
Database](https://www.rackspace.com/managed-hosting/database-services/oracle)
Enterprise Edition. Database administrators use this feature when the standard
object privileges and associated database roles are insufficient to meet your
application security requirements.

<!-- more -->

Oracle VPD enables you to create security policies or group policies to
control database access at the row and column levels. It enables multiple
users to access a single schema while preventing them from accessing data that
isn't relevant to them. VPD uses fine-grained access control (FGAC) to limit
data visibility to specific users. This functionality is also referred to as
row-level security (RLS).

Database administrators generally leverage data access control in the
application that's accessing the data. However, Oracle VPD security policies
provide a mechanism for securing data at the database level itself. The
ability to secure data at a granular database object level is a very powerful
feature of VPD.

VPD automatically adds a dynamic `WHERE` clause to SQL statements that are
issued against a table or view, or that are synonyms of an applied VPD
security policy.

You attach security policies directly to the database tables, views, or
synonyms. Oracle Virtual Private Database enforces security to a fine level of
granularity directly on these objects.

As a result, the policies are automatically applied whenever a user accesses
data from these objects. Oracle Engine dynamically modifies the user's SQL
statement based on the VPD predicate function. There's no way to bypass a VPD
security policy that has been added to these objects.

An additional `WHERE` clause condition is added as returned by the policy
function of the object that the user is accessing. Oracle Engine modifies the
statement dynamically as returned by the predicate function of the VPD policy.
Oracle VPD policies can be applied to `SELECT`, `INSERT`, `UPDATE`, `INDEX`,
and `DELETE` statements.

Oracle VPD policies use the `DBMS_RLS` package for VPD enforcement. The
`DBMS_RLS` package contains the FGAC administrative interface, which is used
to implement VPD. `DBMS_RLS` is available with the Enterprise Edition only.

The following table describes the `DBMS_RLS` package:

| Procedure | Description |
|------------------------|----------------------------------------------------------------------------------------|
| ADD_POLICY | Adds an FGAC policy to a table, view, or synonym. |
| ENABLE_POLICY | Enables or disables an FGAC policy. |
| REFRESH_POLICY | Causes all of the cached statements associated with the policy to be re-parsed. |
| DROP_POLICY | Drops an FGAC policy from a table, view, or synonym. |
| CREATE_POLICY_GROUP | Creates a policy group. |
| DELETE_POLICY_GROUP | Deletes a policy group. |
| ADD_GROUPED_POLICY | Adds a policy associated with a policy group. |
| ENABLE_GROUPED_POLICY | Enables or disables a row-level group security policy. |
| REFRESH_GROUPED_POLICY | Re-parses the SQL statements associated with a refreshed policy. |
| DROP_GROUPED_POLICY | Drops a policy associated with a policy group. |
| DISABLE_GROUPED_POLICY | Disables a row-level group security policy. |
| ADD_POLICY_CONTEXT | Adds the context for the active application. |
| DROP_POLICY_CONTEXT | Drops a driving context from the object so that it has one less driving context. |

The examples in the following sections demonstrate the power of VPDs.

### Example 1: Row-level VPD

In this example, the `PER_PHONES` table is a table that belongs to your
company's Human Resources department, and contains the personal phone numbers
of company employees. You want to secure this table by adding a VPD policy to
this object so that only the `APPS` user may view the data.

To accomplish this task, use the following steps:

1. Create the VPD Policy function in the database where you want to implement
   VPD.

    ![A screenshot showing the command used to create the VPD policy function]({% asset_path 2018-09-14-vpds/picture1.png %})

2. After you've created the policy function, link it to the policy.

    ![A screenshot showing the command used to link the policy to the function]({% asset_path 2018-09-14-vpds/picture2.png %})

3. Query the table `PER_PHONES` as the `APPS` user.

    ![TEXT]({% asset_path 2018-09-14-vpds/picture3.png %})

4. Query the table `PER_PHONES` as a user other than `APPS`.

    ![TEXT]({% asset_path 2018-09-14-vpds/picture4.png %})

    Here VPD is applied to the table `PER_PHONES` for both `APPS` and other
    users when they run a `SELECT` statement on the table. The dynamic
    predicate that the policy function returns causes the data to display
    differently.

### Example 2: Column-level VPD

In this example, you want to conceal data in certain columns in the table `PER_ALL_PEOPLE_F`. You need a VPD policy that only allows `APPS` to see the data in the following columns:

- `DATE_OF_BIRTH`
- `NATIONAL_IDENTIFIER`
- `MARITAL_STATUS`

The data in the other columns is available to all users.

1. Create the VPD policy function.

    ![TEXT]({% asset_path 2018-09-14-vpds/picture5.png %})

2. Create the VPD policy.

    After you've created the policy function, link it to the VPD policy.

    ![TEXT]({% asset_path 2018-09-14-vpds/picture6.png %})

    | Header | Description |
    |-----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | sec_relevant_cols | Enables column-level Virtual Private Database (VPD), which enforces,security policies when a column containing sensitive information is,referenced in a query. Applies to tables and views, but not,to the synonyms. Specify a list of commas- or space-separated valid,column names of the policy-protected object. Default is all the,user-defined columns for the object. |
    | sec_relevant_cols_opt | Use with sec_relevant_cols to display all rows for column-level VPD, filtered queries (`SELECT` only), where sensitive columns appear as NULL.,Default is set to NULL, which allows the filtering defined,with sec_relevant_cols to take effect. Set to dbms_rls. ALL_ROWS to,display all rows, but with sensitive column values, which are filtered by `sec_relevant_cols`, displayed as `NULL`. |

3. Query the table `PER_ALL_PEOPLE_F` as the `APPS` user.

    ![TEXT]({% asset_path 2018-09-14-vpds/picture7.png %})

    The `APPS` user can see all of the column data in the table.

4. Query the table `PER_ALL_PEOPLE_F` as a user other than `APPS`.

    ![TEXT]({% asset_path 2018-09-14-vpds/picture8.png %})

    Other database users can't see the data in these columns because the
    policy function masks those fields.

### Conclusion

VPD enables you to control access to table columns and rows by database users and non-database users (application or end-users). VPD policy groups and driving application context allows for selective hiding of certain application table columns for different application users. The policy function should not have complex logic as that might cause some performance issue.

These examples are tested on Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 (64bit).

[Learn more about Rackspaceâ€™s database
services](https://www.rackspace.com/managed-hosting/database-services).
